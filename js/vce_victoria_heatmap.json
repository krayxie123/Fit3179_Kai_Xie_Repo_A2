{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "VCE School Results Heat Map of Victoria (2021-2024)",
  "params": [
    {
      "name": "year",
      "value": 2024,
      "bind": {
        "input": "range",
        "min": 2021,
        "max": 2024,
        "step": 1
      }
    }
  ],
  "data": {
    "url": "data/VCE_School_Results.csv",
    "format": {"type": "csv", "parse": {"year": "number", "median_vce_ss": "number", "X": "number", "Y": "number"}}
  },
  "transform": [
    {
      "filter": "datum.year == year"
    },
    {
      "filter": "datum.median_vce_ss != null && datum.median_vce_ss != '-'"
    },
    {
      "calculate": "parseFloat(datum.median_vce_ss)",
      "as": "median_score"
    },
    {
      "filter": "datum.median_score > 0"
    }
  ],
  "layer": [
    {
      "mark": {
        "type": "circle",
        "size": 100,
        "opacity": 0.7,
        "stroke": "white",
        "strokeWidth": 1
      },
      "encoding": {
        "longitude": {
          "field": "X",
          "type": "quantitative",
          "scale": {"domain": [140.5, 150.5]}
        },
        "latitude": {
          "field": "Y", 
          "type": "quantitative",
          "scale": {"domain": [-39.5, -33.5]}
        },
        "color": {
          "field": "median_score",
          "type": "quantitative",
          "scale": {
            "domain": [15, 45],
            "range": ["#2166ac", "#4393c3", "#92c5de", "#d1e5f0", "#f7f7f7", "#fddbc7", "#f4a582", "#d6604d", "#b2182b"]
          },
          "legend": {
            "title": "Median VCE Study Score",
            "orient": "bottom"
          }
        },
        "tooltip": [
          {"field": "school", "type": "nominal", "title": "School"},
          {"field": "locality", "type": "nominal", "title": "Suburb"},
          {"field": "median_score", "type": "quantitative", "title": "Median VCE Score", "format": ".1f"},
          {"field": "num_vce_students_enrolled", "type": "quantitative", "title": "VCE Students"},
          {"field": "year", "type": "ordinal", "title": "Year"}
        ]
      }
    },
    {
      "mark": {
        "type": "text",
        "size": 8,
        "opacity": 0.8
      },
      "encoding": {
        "longitude": {
          "field": "X",
          "type": "quantitative"
        },
        "latitude": {
          "field": "Y",
          "type": "quantitative"
        },
        "text": {
          "field": "median_score",
          "type": "quantitative",
          "format": ".0f"
        },
        "color": {
          "value": "white"
        }
      }
    }
  ],
  "projection": {
    "type": "mercator",
    "scale": 1200,
    "translate": [300, 200]
  },
  "width": 600,
  "height": 500,
  "config": {
    "view": {
      "stroke": "transparent"
    },
    "axis": {
      "grid": false,
      "tickSize": 0,
      "domain": false,
      "labels": false
    }
  }
}
